## ORACLE 介质恢复和实例恢复

当实例意外地（如掉电、后台进程故障等）或预料地（发出SHUTDOUM ABORT语句）中止时出现实例故障，此时需要实例恢复。 实例恢复将数据库恢复到故障之前的事务一致状态。

如果有实例故障则需要进行介质恢复。

Oracle在下次启动时会自动的进行实例恢复：  

1. 为了解恢复数据文件中没有记录的数据，进行向前滚。该数据记录在在线日志，包括对回滚段的内容恢复。
2. 回滚未提交的事务，按步1重新生成回滚段所指定的操作。
3. 释放在故障时正在处理事务所持有的资源。
4. 解决在故障时正经历一阶段提交的任何悬而未决的分布事务。

介质恢复使用recover命令将数据库所需的所有提交的数据从归档日志文件或重做日志文件恢复到修复的数据文件中。

##### 介质故障或文件错误的不一致恢复

介质故障是当一个文件、一个文件的部分或磁盘不能读或不能写时出现的故障。文件错误一般指意外的错误导致文件被删除或意外事故导致文件的不一致。这种状态下的数据库都是不一致的，需要DBA手工来进行数据库的恢复，这种恢复有两种形式，决定于数据库运行的归档方式和备份方式。  

1. 完全介质恢复可恢复全部丢失的修改。一般情况下需要有数据库的备份且数据库运行在归档状态下并且有可用归档日志时才可能。对于不同类型的错误，有不同类型的完全恢复可使用，其决定于毁坏文件和数据库的可用性。

2. 不完全介质恢复是在完全介质恢复不可能或不要求时进行的Oracle介质恢复。重构受损的数据库，使其恢复介质故障前或用户出错之前的一个事务一致性状态。不完全介质恢复有不同类型的使用，决定于需要不完全介质恢复的情况，有下列类型：基于撤消、基于时间和基于修改的不完全恢复。

基于撤消(CANCEL)恢复：在某种情况，不完全介质恢复必须被控制，DBA可撤消在指定点的操作。基于撤消的恢复地在一个或多个日志组（在线的或归档的）已被介质故障所破坏，不能用于恢复过程时使用，所以Oracle介质恢复必须控制，以致在使用最近的、未损的日志组于数据文件后中止恢复操作。  
基于时间(TIME)和基于修改(SCN)的恢复：如果DBA希望恢复到过去的某个指定点，是一种理想的不完全介质恢复，一般发生在恢复到某个特定操作之前，恢复到如意外删除某个数据表之前。