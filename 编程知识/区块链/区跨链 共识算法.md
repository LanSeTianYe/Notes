时间：2022-07-26 22:02:02

参考：

1. [共识原理](https://www.cnblogs.com/wanglao/p/11162605.html)
1. [拜占庭容错](https://academy.binance.com/zh/articles/byzantine-fault-tolerance-explained)
2. [什么是区块链共识算法](https://academy.binance.com/zh/articles/what-is-a-blockchain-consensus-algorithm)

## 区块链 共识算法

在分布式系统中（P2P），节点之间用来对某些信息达成共识的算法。

**拜占庭将军问题：** 在某些节点可能出现故障或不诚实行为的情况下，分布式计算机节点网络如何就决策达成一致？

### Pow (Proof of work)

工作量证明。算力搞高的机器更容易获得区块（虽然掷色子的结果是随机的，但是算力高的机器掷的次数多）。

在比特币中，所有节点用区块信息和一个可变更的随机数计算哈希，当计算出的哈希小于等于数值之后，计算出哈希的节点获得记账权。获得出块奖励和交易费。

计算哈希是无记忆的（就像掷色子一样每次出现的点数概率都一样），因此当一个节点把结果广播搭到 `P2P` 网络之后，收到消息的节点计算下一个区块会获得最大利益，保证区块会尽量计算最新区块。

### Pos (Proof of stake)

权益证明，类似于股份制公司，根据拥有的股份进行投票。

以太坊一直准备切换到权益证明，但是权益证明的机制一直设计完善，所以一直在推迟。

投票时先质押股票，如果投票结果被选中则获得区块奖励并锁定权益一段时间，没有选中则退还质押股票。如果作弊则没收质押股票。

### CFT(Crash Fault Tolerance)

碰撞容错，认为机器可能宕机，网络可能异常，但是所有信息真实可信。

需要至少 `2f+1` 台机器。

代表算法：Paxos、Raft等。

#### Paxos

分布式中没有恶意节点的情况，在两阶段提交中，通过保持最大的提案号来确保提案通过，每次只要超过半数即可。

#### Raft

类似于多主从结构，选举出leader再进行两阶段提交。其他节点作为follower遵守leader的决定。

### BFT(Byzantine Fault Tolerance) 

拜占庭容错，认为出错的机器是可能说谎的，即信息不可信，需要 `3f+1`。

代表算法：TBFT、PBFT、POW（工作流证明算法）、XFT（ Cross Fault Tolerance）等。

#### PBFT 

#### ZAP
